<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Cisco CLI to Ansible Converter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .fira-code {
            font-family: 'Fira Code', monospace;
        }
        /* Styles for active and inactive tabs */
        .tab-btn.active {
            background-color: #0891b2; /* cyan-600 */
            color: white;
        }
        .tab-btn {
            transition: background-color 0.2s ease-in-out;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 flex flex-col items-center min-h-screen p-4">

    <div class="w-full max-w-6xl mx-auto">
        <!-- Header Section -->
        <div class="text-center mb-6">
            <h1 class="text-4xl font-bold text-white mb-2">Smart Cisco CLI to Ansible Converter</h1>
            <p class="text-gray-400 max-w-3xl mx-auto">A tool to prevent common errors by building a complete command and playbook.</p>
        </div>

        <!-- Tab Navigation -->
        <div class="mb-6 flex justify-center border-b border-gray-700">
            <button class="tab-btn active text-lg font-semibold py-3 px-6 text-gray-400 hover:bg-gray-800 rounded-t-lg" data-tab="playbook-generator">Playbook Generator</button>
            <button class="tab-btn text-lg font-semibold py-3 px-6 text-gray-400 hover:bg-gray-800 rounded-t-lg" data-tab="inventory-builder">Inventory Builder</button>
            <button class="tab-btn text-lg font-semibold py-3 px-6 text-gray-400 hover:bg-gray-800 rounded-t-lg" data-tab="backup-restore">Backup & Restore</button>
        </div>

        <!-- Tab Content -->
        <div id="tab-container">
            <!-- Playbook Generator Tab -->
            <div id="playbook-generator" class="tab-content active">
                <!-- Setup Section -->
                <div class="bg-gray-800 p-6 rounded-xl shadow-lg mb-6">
                    <h2 class="text-2xl font-semibold mb-4 text-white">1. Playbook Setup</h2>
                    <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 items-start">
                        <div>
                            <label for="inventoryFile" class="block text-sm font-medium text-cyan-400 mb-1">Inventory File Name <span class="text-gray-500">(Optional)</span></label>
                            <input type="text" id="inventoryFile" class="w-full bg-gray-900 text-gray-300 p-2 rounded-lg border-2 border-gray-700 focus:border-cyan-500 focus:ring-cyan-500 transition duration-200" placeholder="inventory.ini">
                        </div>
                        <div>
                            <label for="hostsGroup" class="block text-sm font-medium text-cyan-400 mb-1">Ansible Hosts Group <span class="text-gray-500">(Optional)</span></label>
                            <input type="text" id="hostsGroup" class="w-full bg-gray-900 text-gray-300 p-2 rounded-lg border-2 border-gray-700 focus:border-cyan-500 focus:ring-cyan-500 transition duration-200" placeholder="network_devices">
                        </div>
                        <div>
                            <label for="playbookFile" class="block text-sm font-medium text-cyan-400 mb-1">Playbook File Name <span class="text-gray-500">(Optional)</span></label>
                            <input type="text" id="playbookFile" class="w-full bg-gray-900 text-gray-300 p-2 rounded-lg border-2 border-gray-700 focus:border-cyan-500 focus:ring-cyan-500 transition duration-200" placeholder="configure_switch.yml">
                        </div>
                        <div>
                            <label for="sshUser" class="block text-sm font-medium text-cyan-400 mb-1">SSH Username <span class="text-gray-500">(Optional)</span></label>
                            <input type="text" id="sshUser" class="w-full bg-gray-900 text-gray-300 p-2 rounded-lg border-2 border-gray-700 focus:border-cyan-500 focus:ring-cyan-500 transition duration-200" placeholder="cisco">
                        </div>
                        <div class="lg:col-span-4 grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-2">
                             <div class="flex items-center">
                                <input type="checkbox" id="becomeCheckbox" class="h-4 w-4 rounded border-gray-500 text-cyan-600 focus:ring-cyan-500 bg-gray-700 mr-2 cursor-pointer">
                                <label for="becomeCheckbox" class="text-sm font-medium text-cyan-400 cursor-pointer">Use Enable Mode (`become`)</label>
                            </div>
                             <div class="flex items-center">
                                <input type="checkbox" id="parseOutputCheckbox" class="h-4 w-4 rounded border-gray-500 text-cyan-600 focus:ring-cyan-500 bg-gray-700 mr-2 cursor-pointer">
                                <label for="parseOutputCheckbox" class="text-sm font-medium text-cyan-400 cursor-pointer">Parse 'show' command output (Advanced)</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Main Content Grid -->
                <div class="grid lg:grid-cols-2 gap-6">
                    <div class="bg-gray-800 p-6 rounded-xl shadow-lg">
                        <h2 class="text-2xl font-semibold mb-4 text-white">2. Enter CLI Commands</h2>
                        <textarea id="cliInput" class="w-full h-96 bg-gray-900 text-gray-300 p-4 rounded-lg border-2 border-gray-700 focus:border-cyan-500 focus:ring-cyan-500 transition duration-200 fira-code resize-none" placeholder="hostname CORE-SWITCH-01&#10;sh ip int br"></textarea>
                    </div>
                    <div class="bg-gray-800 p-6 rounded-xl shadow-lg space-y-6">
                        <h2 class="text-2xl font-semibold mb-2 text-white">3. Get Your Playbook</h2>
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <label class="block text-lg font-semibold text-emerald-400">Ansible Playbook YAML</label>
                                <button id="copyYamlBtn" class="bg-gray-700 hover:bg-emerald-600 text-white font-bold py-1 px-3 rounded-lg transition duration-200 text-sm">Copy</button>
                            </div>
                            <pre class="w-full h-64 bg-gray-900 p-3 rounded-lg border-2 border-gray-700 overflow-auto"><code id="yamlOutput" class="fira-code text-gray-300 whitespace-pre"># Fill setup to generate...</code></pre>
                        </div>
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <label class="block text-lg font-semibold text-emerald-400">Run Command</label>
                                <button id="copyCmdBtn" class="bg-gray-700 hover:bg-emerald-600 text-white font-bold py-1 px-3 rounded-lg transition duration-200 text-sm">Copy</button>
                            </div>
                            <pre class="w-full bg-gray-900 p-3 rounded-lg border-2 border-gray-700 overflow-auto"><code id="runCommand" class="fira-code text-gray-300 whitespace-pre"># Fill setup to generate...</code></pre>
                            <p id="k-flag-note" class="text-xs text-gray-400 mt-2" style="display: none;">Note: The `-k` flag will prompt for the SSH password.</p>
                            <p id="K-flag-note" class="text-xs text-gray-400 mt-1" style="display: none;">Note: The `-K` flag will prompt for the enable password.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Inventory Builder Tab -->
            <div id="inventory-builder" class="tab-content">
                <div class="bg-gray-800 p-6 rounded-xl shadow-lg">
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <div>
                                <label for="inventoryGroupName" class="block text-sm font-medium text-cyan-400 mb-1">Inventory Group Name</label>
                                <input type="text" id="inventoryGroupName" class="w-full bg-gray-900 text-gray-300 p-2 rounded-lg border-2 border-gray-700 focus:border-cyan-500 focus:ring-cyan-500 transition duration-200" placeholder="cisco_switches">
                            </div>
                            <div>
                                <label for="ipList" class="block text-sm font-medium text-cyan-400 mb-1">Enter IP Addresses (one per line)</label>
                                <textarea id="ipList" class="w-full h-48 bg-gray-900 text-gray-300 p-4 rounded-lg border-2 border-gray-700 focus:border-cyan-500 focus:ring-cyan-500 transition duration-200 fira-code resize-none" placeholder="192.168.1.10&#10;192.168.1.11"></textarea>
                            </div>
                            <button id="buildInventoryBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200 text-base shadow-md hover:shadow-lg w-full">Build Inventory File</button>
                        </div>
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <label class="block text-lg font-semibold text-emerald-400">Generated Inventory</label>
                                <button id="copyInventoryBtn" class="bg-gray-700 hover:bg-emerald-600 text-white font-bold py-1 px-3 rounded-lg transition duration-200 text-sm">Copy</button>
                            </div>
                            <pre class="w-full h-72 bg-gray-900 p-3 rounded-lg border-2 border-gray-700 overflow-auto"><code id="inventoryOutput" class="fira-code text-gray-300 whitespace-pre"># Inventory will appear here...</code></pre>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Backup & Restore Tab -->
            <div id="backup-restore" class="tab-content">
                <div class="grid lg:grid-cols-2 gap-6">
                    <!-- Backup Section -->
                    <div class="bg-gray-800 p-6 rounded-xl shadow-lg">
                        <h2 class="text-2xl font-semibold mb-4 text-white">Backup Configuration</h2>
                        <div class="space-y-4">
                            <div>
                                <label for="backupHostsGroup" class="block text-sm font-medium text-cyan-400 mb-1">Target Hosts Group</label>
                                <input type="text" id="backupHostsGroup" class="w-full bg-gray-900 text-gray-300 p-2 rounded-lg border-2 border-gray-700 focus:border-cyan-500 focus:ring-cyan-500 transition duration-200" placeholder="cisco_switches">
                            </div>
                            <button id="generateBackupBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200 text-base shadow-md hover:shadow-lg w-full">Generate Backup Playbook</button>
                             <div>
                                <label class="block text-lg font-semibold text-emerald-400 mt-4">Backup Playbook</label>
                                <pre class="w-full h-48 bg-gray-900 p-3 rounded-lg border-2 border-gray-700 overflow-auto mt-2"><code id="backupPlaybookOutput" class="fira-code text-gray-300 whitespace-pre"># Playbook will appear here...</code></pre>
                            </div>
                        </div>
                    </div>
                    <!-- Restore Section -->
                    <div class="bg-gray-800 p-6 rounded-xl shadow-lg">
                        <h2 class="text-2xl font-semibold mb-4 text-white">Restore Configuration</h2>
                        <div class="bg-red-900 border border-red-700 text-red-300 px-4 py-3 rounded-lg mb-4">
                            <strong>Warning:</strong> This is a destructive operation and will overwrite the device's running configuration. Use with extreme caution.
                        </div>
                        <div class="space-y-4">
                            <div>
                                <label for="restoreHost" class="block text-sm font-medium text-cyan-400 mb-1">Target Host Name (from inventory)</label>
                                <input type="text" id="restoreHost" class="w-full bg-gray-900 text-gray-300 p-2 rounded-lg border-2 border-gray-700 focus:border-cyan-500 focus:ring-cyan-500 transition duration-200" placeholder="switch-1">
                            </div>
                             <div>
                                <label for="restoreFile" class="block text-sm font-medium text-cyan-400 mb-1">Path to Backup File</label>
                                <input type="text" id="restoreFile" class="w-full bg-gray-900 text-gray-300 p-2 rounded-lg border-2 border-gray-700 focus:border-cyan-500 focus:ring-cyan-500 transition duration-200" placeholder="./backup/switch-1_config.2025-07-13@15-19-15">
                            </div>
                            <button id="generateRestoreBtn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200 text-base shadow-md hover:shadow-lg w-full">Generate Restore Playbook</button>
                             <div>
                                <label class="block text-lg font-semibold text-emerald-400 mt-4">Restore Playbook</label>
                                <pre class="w-full h-48 bg-gray-900 p-3 rounded-lg border-2 border-gray-700 overflow-auto mt-2"><code id="restorePlaybookOutput" class="fira-code text-gray-300 whitespace-pre"># Playbook will appear here...</code></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="mt-6 flex justify-center gap-4">
            <button id="convertBtn" class="bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-3 px-8 rounded-lg transition duration-200 text-lg shadow-md hover:shadow-lg">Generate Playbook</button>
            <button id="clearBtn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-8 rounded-lg transition duration-200 text-lg shadow-md hover:shadow-lg">Clear All</button>
        </div>
    </div>

    <script>
        // --- DOM Element Selection ---
        const cliInput = document.getElementById('cliInput');
        const yamlOutput = document.getElementById('yamlOutput');
        const runCommand = document.getElementById('runCommand');
        
        const inventoryGroupName = document.getElementById('inventoryGroupName');
        const ipList = document.getElementById('ipList');
        const buildInventoryBtn = document.getElementById('buildInventoryBtn');
        const inventoryOutput = document.getElementById('inventoryOutput');
        const copyInventoryBtn = document.getElementById('copyInventoryBtn');

        const inventoryFile = document.getElementById('inventoryFile');
        const hostsGroup = document.getElementById('hostsGroup');
        const playbookFile = document.getElementById('playbookFile');
        const sshUser = document.getElementById('sshUser');
        const parseOutputCheckbox = document.getElementById('parseOutputCheckbox');
        const becomeCheckbox = document.getElementById('becomeCheckbox');
        const kFlagNote = document.getElementById('k-flag-note');
        const KFlagNote = document.getElementById('K-flag-note');

        const convertBtn = document.getElementById('convertBtn');
        const copyYamlBtn = document.getElementById('copyYamlBtn');
        const copyCmdBtn = document.getElementById('copyCmdBtn');
        const clearBtn = document.getElementById('clearBtn');
        
        // Backup & Restore selectors
        const backupHostsGroup = document.getElementById('backupHostsGroup');
        const generateBackupBtn = document.getElementById('generateBackupBtn');
        const backupPlaybookOutput = document.getElementById('backupPlaybookOutput');
        const restoreHost = document.getElementById('restoreHost');
        const restoreFile = document.getElementById('restoreFile');
        const generateRestoreBtn = document.getElementById('generateRestoreBtn');
        const restorePlaybookOutput = document.getElementById('restorePlaybookOutput');

        const allSetupFields = [inventoryFile, hostsGroup, playbookFile, sshUser, inventoryGroupName, ipList, backupHostsGroup, restoreHost, restoreFile];
        
        // --- Tab Switching Logic ---
        const tabButtons = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');

        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                tabButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');

                const tabId = button.dataset.tab;
                tabContents.forEach(content => {
                    content.classList.remove('active');
                    if (content.id === tabId) {
                        content.classList.add('active');
                    }
                });
            });
        });

        // --- Inventory Builder Logic ---
        function buildInventory() {
            const groupName = inventoryGroupName.value.trim() || 'cisco_switches';
            const ips = ipList.value.trim().split('\n').map(ip => ip.trim()).filter(ip => ip);

            if (ips.length === 0) {
                inventoryOutput.textContent = '# Please enter at least one IP address.';
                return;
            }

            let inventoryContent = `[${groupName}]\n`;
            ips.forEach((ip, index) => {
                const deviceName = `switch-${index + 1}`;
                inventoryContent += `${deviceName} ansible_host=${ip} ansible_network_os=cisco.ios.ios ansible_connection=network_cli\n`;
            });

            inventoryOutput.textContent = inventoryContent;
        }

        // --- Backup & Restore Logic ---
        function generateBackupPlaybook() {
            const group = backupHostsGroup.value.trim() || 'cisco_switches';
            const playbook = `---
- name: Backup Device Configurations
  hosts: ${group}
  gather_facts: no
  connection: network_cli

  tasks:
    - name: Backup running configuration
      cisco.ios.ios_config:
        backup: yes
      register: backup_results

    - name: Show backup file path
      debug:
        msg: "Configuration for {{ inventory_hostname }} saved to {{ backup_results.backup_path }}"`;
            backupPlaybookOutput.textContent = playbook;
        }
        
        function generateRestorePlaybook() {
            const host = restoreHost.value.trim() || '<target_host>';
            const file = restoreFile.value.trim() || '<path_to_backup_file>';
             const playbook = `---
- name: Restore Device Configuration
  hosts: ${host}
  gather_facts: no
  connection: network_cli
  become: yes
  become_method: enable

  tasks:
    - name: Restore configuration from file
      cisco.ios.ios_config:
        src: ${file}
      notify: Save configuration

  handlers:
    - name: Save configuration
      cisco.ios.ios_config:
        save_when: always`;
            restorePlaybookOutput.textContent = playbook;
        }

        // --- Playbook Generation Logic ---
        function convertCliToYaml() {
            // ... (existing playbook generation logic remains the same)
            const cliCommandsText = cliInput.value.trim();
            if (!cliCommandsText) {
                yamlOutput.textContent = '# Please enter some CLI commands to generate the playbook.';
                runCommand.textContent = '# Enter CLI commands to generate the run command.';
                return;
            }

            const allCommands = cliCommandsText.split('\n').map(line => line.trim()).filter(line => line.length > 0);
            
            const showCommands = allCommands.filter(cmd => {
                const lowerCmd = cmd.toLowerCase();
                const firstWord = lowerCmd.split(' ')[0];
                return lowerCmd.startsWith('show') || firstWord === 'sh';
            });
            const configCommands = allCommands.filter(cmd => !showCommands.includes(cmd));

            let tasksYaml = [];
            const parseOutput = parseOutputCheckbox.checked;

            if (configCommands.length > 0) {
                const configLines = configCommands.map(cmd => `        - ${cmd}`).join('\n');
                tasksYaml.push(`    - name: Apply configuration commands
      cisco.ios.ios_config:
        lines:
${configLines}`);
            }
            
            showCommands.forEach((cmd, index) => {
                const varName = `show_result_${index}`;
                if (parseOutput) {
                    tasksYaml.push(`    - name: Parse command "${cmd}"
      cisco.ios.ios_command:
        commands:
          - ${cmd}
        parser:
          name: ansible.netcommon.ntc_templates
      register: ${varName}`);
                    tasksYaml.push(`    - name: Display parsed output for "${cmd}"
      debug:
        var: ${varName}.stdout[0]`);
                } else {
                    tasksYaml.push(`    - name: Verify with command "${cmd}"
      cisco.ios.ios_command:
        commands:
          - ${cmd}
      register: ${varName}`);
                    tasksYaml.push(`    - name: Display verification output for "${cmd}"
      debug:
        msg: "{{ item }}"
      loop: "{{ ${varName}.stdout_lines }}"`);
                }
            });
            
            if (tasksYaml.length === 0) {
                 yamlOutput.textContent = '# No valid commands found.';
                 return;
            }
            
            const hosts = hostsGroup.value.trim() || 'your_hosts_group';
            const useBecome = becomeCheckbox.checked;
            
            let becomeBlock = '';
            if (useBecome) {
                becomeBlock = `
  become: yes
  become_method: enable`;
            }

            const playbookTemplate = `---
- name: Generated Cisco Playbook
  hosts: ${hosts}
  gather_facts: no
  connection: network_cli${becomeBlock}

  tasks:
${tasksYaml.join('\n\n')}`;

            yamlOutput.textContent = playbookTemplate;
            
            const inv = inventoryFile.value.trim() || '<inventory.ini>';
            const play = playbookFile.value.trim() || '<playbook.yml>';
            const user = sshUser.value.trim();

            let command = `ansible-playbook -i ${inv} ${play}`;
            if (user) {
                command += ` -u ${user} -k`;
                kFlagNote.style.display = 'block';
            } else {
                kFlagNote.style.display = 'none';
            }
            if (useBecome) {
                command += ' -K';
                KFlagNote.style.display = 'block';
            } else {
                KFlagNote.style.display = 'none';
            }
            runCommand.textContent = command;
        }

        // --- Clipboard Copy Logic ---
        function copyToClipboard(elementId, button) {
            const textToCopy = document.getElementById(elementId).textContent;
            if (textToCopy.startsWith('#')) return;

            const textArea = document.createElement("textarea");
            textArea.value = textToCopy;
            textArea.style.position = "fixed";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                document.execCommand('copy');
            } catch (err) {
                console.error('Oops, unable to copy', err);
            }
            document.body.removeChild(textArea);

            const originalText = button.textContent;
            button.textContent = 'Copied!';
            button.classList.add('bg-emerald-600');
            setTimeout(() => {
                button.textContent = originalText;
                button.classList.remove('bg-emerald-600');
            }, 2000);
        }
        
        // --- Clear Logic ---
        function clearFields() {
            cliInput.value = '';
            allSetupFields.forEach(field => {
                field.value = '';
            });
            parseOutputCheckbox.checked = false;
            becomeCheckbox.checked = false;
            yamlOutput.textContent = '# Fill setup to generate...';
            runCommand.textContent = '# Fill setup to generate...';
            inventoryOutput.textContent = '# Inventory will appear here...';
            backupPlaybookOutput.textContent = '# Playbook will appear here...';
            restorePlaybookOutput.textContent = '# Playbook will appear here...';
            kFlagNote.style.display = 'none';
            KFlagNote.style.display = 'none';
        }

        // --- Event Listeners ---
        buildInventoryBtn.addEventListener('click', buildInventory);
        copyInventoryBtn.addEventListener('click', () => copyToClipboard('inventoryOutput', copyInventoryBtn));
        convertBtn.addEventListener('click', convertCliToYaml);
        copyYamlBtn.addEventListener('click', () => copyToClipboard('yamlOutput', copyYamlBtn));
        copyCmdBtn.addEventListener('click', () => copyToClipboard('runCommand', copyCmdBtn));
        generateBackupBtn.addEventListener('click', generateBackupPlaybook);
        generateRestoreBtn.addEventListener('click', generateRestorePlaybook);
        clearBtn.addEventListener('click', clearFields);
    </script>

</body>
</html>
